<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FastAPI Chat</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 2rem auto; }
    #messages { border: 1px solid #ccc; height: 300px; overflow-y: auto; padding: 10px; background: #f9f9f9; }
    #messages div { margin-bottom: 8px; background: #e1f5fe; padding: 6px; border-radius: 4px; }
    #input-container { margin-top: 10px; display: flex; gap: 8px; }
    #input-container input { flex: 1; padding: 10px; font-size: 16px; }
    #input-container button { padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>
  <h2>FastAPI Chat Room</h2>
  <div id="messages"></div>
  <div id="input-container">
    <input id="messageInput" placeholder="Type your message..." autocomplete="off" />
    <button id="sendBtn">Send</button>
  </div>

  <script>
    const ws = new WebSocket(`ws://${location.host}/ws/chat`);
    const messagesDiv = document.getElementById("messages");
    const input = document.getElementById("messageInput");
    const sendBtn = document.getElementById("sendBtn");

    function addMessage(msg) {
      const div = document.createElement("div");
      div.textContent = msg;
      messagesDiv.appendChild(div);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    ws.onmessage = (event) => {
      addMessage(event.data);
    };

    sendBtn.onclick = () => {
      const msg = input.value.trim();
      if (!msg) return;
      ws.send(msg);
      input.value = "";
      input.focus();
    };

    input.addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        sendBtn.click();
      }
    });

    ws.onopen = () => {
      input.disabled = false;
      sendBtn.disabled = false;
    };

    ws.onclose = () => {
      addMessage("Disconnected from server.");
      input.disabled = true;
      sendBtn.disabled = true;
    };

    input.disabled = true;
    sendBtn.disabled = true;
  </script>
</body>
</html>
