<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FastAPI Chatroom</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: 2em auto; }
  #messages { 
    width: 100%; 
    height: 300px; 
    border: 1px solid #ccc; 
    padding: 0.5em; 
    overflow-y: scroll; 
    white-space: pre-wrap;
    background-color: #f9f9f9;
  }
  #input { 
    width: 80%; 
    padding: 0.5em; 
    font-size: 1em; 
  }
  #sendBtn {
    padding: 0.5em 1em; 
    font-size: 1em;
  }
</style>
</head>
<body>

<h2>Chatroom</h2>
<div id="messages" readonly></div>

<input type="text" id="input" placeholder="Type your message here..." />
<button id="sendBtn">Send</button>

<script>
  const messagesDiv = document.getElementById('messages');
  const input = document.getElementById('input');
  const sendBtn = document.getElementById('sendBtn');

  // Use wss:// if page is https, else ws://
  const protocol = window.location.protocol === "https:" ? "wss" : "ws";
  const ws = new WebSocket(`${protocol}://${window.location.host}/ws/chat`);

  ws.onmessage = (event) => {
    // Append received message to messages div
    messagesDiv.textContent += event.data + '\n';
    messagesDiv.scrollTop = messagesDiv.scrollHeight; // scroll to bottom
  };

  sendBtn.onclick = () => {
    const msg = input.value.trim();
    if (msg !== '') {
      ws.send(msg);
      input.value = '';
    }
  };

  // Send message on Enter key press
  input.addEventListener('keyup', (e) => {
    if (e.key === 'Enter') {
      sendBtn.click();
    }
  });

  ws.onopen = () => {
    console.log("WebSocket connection opened.");
  };

  ws.onerror = (error) => {
    console.error("WebSocket error:", error);
  };

  ws.onclose = () => {
    console.log("WebSocket connection closed.");
  };
</script>

</body>
</html>
